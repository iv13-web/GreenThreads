(()=>{"use strict";var e;!function(e){e.low="low",e.default="default",e.high="high",e.critical="critical"}(e||(e={}));const t=5e6,i={[e.low]:.5,[e.default]:1,[e.high]:2,[e.critical]:4},o=[e.critical,e.low,e.critical,e.default,e.high,e.low,e.critical,e.low,e.default,e.high],r=document.querySelector(".indicator-wrapper");o.forEach((e=>{(e=>{const t=`\n\t\t<span class="priority">${e} priority</span>\n\t\t<div class="indicator">\n\t\t\t<div class="progress ${e}"></div>\n\t\t</div>\n\t`;r.insertAdjacentHTML("beforeend",t)})(e)}));const s={button:document.querySelector("button"),underlay:document.querySelector(".plate-underlay"),indicatorsWrapper:document.querySelector(".indicator-wrapper"),indicators:[...document.querySelectorAll(".indicator")],progresses:[...document.querySelectorAll(".progress")]},c={critical:"background-color:#ffc7d2;color:#000;font-size:16px;font-weight:bold",high:"background-color:#ffcda6;color:#000;font-size:16px;font-weight:bold",default:"background-color:#ffbbf5;color:#000;font-size:16px;font-weight:bold",low:"background-color:#c5db93;color:#000;font-size:16px;font-weight:bold"};s.button.addEventListener("click",(()=>{const{underlay:e}=s;e.classList.contains("clicked")?(e.classList.remove("clicked"),setTimeout((()=>{e.classList.add("clicked")}))):e.classList.add("clicked")}));const n=new class{overallExecTimeForOneIteration;staleTime;execTimePerOneCoefficientPoint;tasks=new Set;tasksQueue=[];hasExecutionStarted=!1;constructor({overallExecTimeForOneIteration:e,staleTime:t}={}){this.overallExecTimeForOneIteration=e||14,this.staleTime=t||21}*createWorker(e,t,o){const r=e[Symbol.iterator]();let s=performance.now(),c=0;for(;;){const{done:n,value:a}=r.next();if(n)return;performance.now()-s>this.execTimePerOneCoefficientPoint*i[o]&&(yield"pause",s=performance.now());try{t(a,c,e)}catch(e){e instanceof Error&&(yield e)}c+=1}}setExecTimePerOneCoefficientPoint(){let e=0;for(const t of this.tasks.values())e+=i[t.priority];this.execTimePerOneCoefficientPoint=this.overallExecTimeForOneIteration/e}setTaskQueue(){for(const e of this.tasks.values()){let t=this.tasksQueue.length-1;for(;null!=this.tasksQueue[t]&&i[this.tasksQueue[t].priority]<i[e.priority];)this.tasksQueue[t+1]=this.tasksQueue[t],t-=1;this.tasksQueue[t+1]=e}}iterate(){this.setExecTimePerOneCoefficientPoint(),this.setTaskQueue();let e=this.tasksQueue.shift();for(;e;){const{done:t,value:i}=e.worker.next();t&&(this.tasks.delete(e),e.resolve()),i instanceof Error&&e.reject(i),e=this.tasksQueue.shift()}setTimeout((()=>{this.tasks.size>0?this.iterate():this.hasExecutionStarted=!1}),this.staleTime)}execute(){this.hasExecutionStarted||(this.hasExecutionStarted=!0,setTimeout(this.iterate.bind(this)))}onEach(t,i,o={priority:e.default}){const{priority:r}=o,s=this.createWorker(t,i,r);return new Promise(((e,t)=>{this.tasks.add({worker:s,priority:r,resolve:e,reject:t}),this.execute()}))}},a=[...Array(t).keys()];o.forEach(((e,i)=>{n.onEach(a,((o,r)=>{const c=r+1,n=c/t*100,{progresses:a}=s;a[i].style.width=`${n}%`,r%1e5!=0&&c!==t||console.log(`${r} elements of ${e.toUpperCase()} queue iterated`)}),{priority:e}).then(((e,t)=>()=>{console.log(`%cFINISH ${e.toUpperCase()} priority queue`,`${c[e]}`)})(e))}))})();